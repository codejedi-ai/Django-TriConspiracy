{% extends 'blog/base.html' %}

{% block content %}
  <div class="row">
    <div class="col s12 m7">
      <h5>Upcoming Events</h5>
      <ul class="collection" id="event-list">
        {% for event in events %}
          <li class="collection-item avatar">
            <i class="material-icons circle purple">event</i>
            <span class="title"><a href="{% url 'blog:event_detail' event.id %}">{{ event.title }}</a></span>
            <p>{{ event.starts_at|date:'M d, Y H:i' }}<br/>
            {{ event.location }}</p>
            <a href="{% url 'blog:event_detail' event.id %}" class="secondary-content"><i class="material-icons">chevron_right</i></a>
          </li>
        {% empty %}
          <li class="collection-item">No events yet. Create one!</li>
        {% endfor %}
      </ul>
    </div>
    <div class="col s12 m5">
      <h5>Create Event</h5>
      <form id="create-event-form">
        <div class="input-field">
          <input id="title" name="title" type="text" required>
          <label for="title">Title</label>
        </div>
        <div class="input-field">
          <input id="starts_at" name="starts_at" type="datetime-local">
          <label class="active" for="starts_at">Start Time</label>
        </div>
        <div class="input-field">
          <input id="location" name="location" type="text">
          <label for="location">Location</label>
        </div>
        <div class="input-field">
          <textarea id="description" name="description" class="materialize-textarea"></textarea>
          <label for="description">Description</label>
        </div>
        <button class="btn waves-effect waves-light purple" type="submit">Create</button>
      </form>
    </div>
  </div>

  <script>
    $(function(){
      $('#create-event-form').on('submit', function(e){
        e.preventDefault();
        $.post('{% url "blog:api_create_event" %}', $(this).serialize())
          .done(function(resp){
            M.toast({html: 'Event created'});
            window.location = '/events/' + resp.event.id + '/';
          })
          .fail(function(xhr){
            M.toast({html: (xhr.responseJSON && xhr.responseJSON.error) || 'Error'});
          });
      });
    });
  </script>
{% endblock %}

