{% extends 'blog/base.html' %}

{% block content %}
  <div class="row">
    <div class="col s12">
      <h4>{{ event.title }}</h4>
      <p class="grey-text">{{ event.starts_at|date:'M d, Y H:i' }} â€¢ {{ event.location }}</p>
      <p>{{ event.description }}</p>
      <div class="divider" style="margin: 16px 0;"></div>
    </div>
  </div>

  <div class="row">
    <div class="col s12 m6">
      <h5>Questions</h5>
      <ul class="collection" id="question-list">
        {% for q in questions %}
          <li class="collection-item">
            <span class="title">{{ q.text }}</span>
            <p>A) {{ q.choice_a }}<br/>B) {{ q.choice_b }}{% if q.choice_c %}<br/>C) {{ q.choice_c }}{% endif %}{% if q.choice_d %}<br/>D) {{ q.choice_d }}{% endif %}</p>
            <span class="new badge" data-badge-caption="correct">{{ q.correct_choice }}</span>
          </li>
        {% empty %}
          <li class="collection-item">No questions yet.</li>
        {% endfor %}
      </ul>

      <h6>Add Question</h6>
      <form id="create-question-form">
        <input type="hidden" name="event_id" value="{{ event.id }}"/>
        <div class="input-field"><input id="text" name="text" required><label for="text">Question</label></div>
        <div class="input-field"><input id="choice_a" name="choice_a" required><label for="choice_a">Choice A</label></div>
        <div class="input-field"><input id="choice_b" name="choice_b" required><label for="choice_b">Choice B</label></div>
        <div class="input-field"><input id="choice_c" name="choice_c"><label for="choice_c">Choice C (optional)</label></div>
        <div class="input-field"><input id="choice_d" name="choice_d"><label for="choice_d">Choice D (optional)</label></div>
        <div class="input-field">
          <select id="correct_choice" name="correct_choice">
            <option value="A" selected>A</option>
            <option value="B">B</option>
            <option value="C">C</option>
            <option value="D">D</option>
          </select>
          <label>Correct Choice</label>
        </div>
        <button class="btn purple" type="submit">Add Question</button>
      </form>
    </div>

    <div class="col s12 m6">
      <h5>Prizes</h5>
      <ul class="collection" id="prize-list">
        {% for p in prizes %}
          <li class="collection-item">#{{ p.rank }} - {{ p.name }} <span class="grey-text right">${{ p.value }}</span><br/><span class="grey-text">{{ p.description }}</span></li>
        {% empty %}
          <li class="collection-item">No prizes yet.</li>
        {% endfor %}
      </ul>

      <h6>Add Prize</h6>
      <form id="create-prize-form">
        <input type="hidden" name="event_id" value="{{ event.id }}"/>
        <div class="input-field"><input id="p_name" name="name" required><label for="p_name">Prize Name</label></div>
        <div class="input-field"><input id="p_rank" name="rank" type="number" min="1" required><label for="p_rank">Rank (1=First)</label></div>
        <div class="input-field"><input id="p_value" name="value" type="number" step="0.01"><label for="p_value">Value</label></div>
        <div class="input-field"><textarea id="p_desc" name="description" class="materialize-textarea"></textarea><label for="p_desc">Description</label></div>
        <button class="btn purple" type="submit">Add Prize</button>
      </form>

      <div class="divider" style="margin: 16px 0;"></div>
      <h5>Placements</h5>
      <ul class="collection" id="placement-list">
        {% for pl in placements %}
          <li class="collection-item">#{{ pl.rank }} - {{ pl.participant_name }} <span class="right">{{ pl.score }} pts</span></li>
        {% empty %}
          <li class="collection-item">No placements yet.</li>
        {% endfor %}
      </ul>

      <h6>Add Placement</h6>
      <form id="create-placement-form">
        <input type="hidden" name="event_id" value="{{ event.id }}"/>
        <div class="input-field"><input id="pl_name" name="participant_name" required><label for="pl_name">Participant Name</label></div>
        <div class="input-field"><input id="pl_score" name="score" type="number" value="0"><label for="pl_score">Score</label></div>
        <div class="input-field"><input id="pl_rank" name="rank" type="number" min="1" required><label for="pl_rank">Rank</label></div>
        <button class="btn purple" type="submit">Add Placement</button>
      </form>
    </div>
  </div>

  <script>
    $(function(){
      $('select').formSelect();

      $('#create-question-form').on('submit', function(e){
        e.preventDefault();
        $.post('{% url "blog:api_create_question" %}', $(this).serialize())
          .done(function(){ M.toast({html: 'Question added'}); location.reload(); })
          .fail(function(xhr){ M.toast({html: (xhr.responseJSON && xhr.responseJSON.error) || 'Error'}); });
      });

      $('#create-prize-form').on('submit', function(e){
        e.preventDefault();
        $.post('{% url "blog:api_create_prize" %}', $(this).serialize())
          .done(function(){ M.toast({html: 'Prize added'}); location.reload(); })
          .fail(function(xhr){ M.toast({html: (xhr.responseJSON && xhr.responseJSON.error) || 'Error'}); });
      });

      $('#create-placement-form').on('submit', function(e){
        e.preventDefault();
        $.post('{% url "blog:api_create_placement" %}', $(this).serialize())
          .done(function(){ M.toast({html: 'Placement added'}); location.reload(); })
          .fail(function(xhr){ M.toast({html: (xhr.responseJSON && xhr.responseJSON.error) || 'Error'}); });
      });
    });
  </script>
{% endblock %}

